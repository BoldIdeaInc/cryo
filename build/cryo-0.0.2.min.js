/*
 The MIT license.
 @copyright Copyright (c) 2010 Skookum, skookum.com
*/
(function(){function f(a){return"object"===typeof a?a instanceof Array?"array":a instanceof Date?"date":"object":typeof a}function l(a,b,d){d=d||[];var c=f(a);if(-1!==s.indexOf(c)){c=d.indexOf(a);if(-1===c){var c={},e;for(e in a)a.hasOwnProperty(e)&&(c[e]=l(a[e],b,d));c=b.push({contents:c,value:m(a)})-1;d[c]=a}return g+c}return m(a)}function n(a,b){if(h(a,g)){var d=parseInt(a.slice(g.length),10),c=b[d],d=p(c.value),c=c.contents,e;for(e in c)d[e]=n(c[e],b);return d}return p(a)}function m(a){var b=
f(a);return"undefined"===b?q:"function"===b?j+a.toString():"date"===b?k+a.getTime():Infinity===a?r:a}function p(a){if("string"===f(a)){if(a===q)return;if(h(a,j)){a=a.slice(j.length);var b=a.indexOf("(")+1,d=a.indexOf(")",b),b=a.slice(b,d),d=a.indexOf("{")+1,c=a.lastIndexOf("}")-1;a=a.slice(d,c);return new Function(b,a)}if(h(a,k))return a=parseInt(a.slice(k.length),10),new Date(a);if(a===r)return Infinity}return a}function h(a,b){return"string"===f(a)&&a.slice(0,b.length)===b}var s=["object","array",
"date","function"],g="_CRYO_REF_",r="_CRYO_INFINITY_",j="_CRYO_FUNCTION_",q="_CRYO_UNDEFINED_",k="_CRYO_DATE_";Cryo={stringify:function(a){var b=[];a=l(a,b);return JSON.stringify({root:a,references:b})},parse:function(a){a=JSON.parse(a);return n(a.root,a.references)}};"undefined"!==typeof define&&define.amd?define("Cryo",[],function(){return Cryo}):"undefined"!==typeof module&&module.exports?module.exports=Cryo:this.Cryo=Cryo})();
